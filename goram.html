<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GorAM Supreme</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #ff9f1a;
            --accent: #ff3838;
            --bg: #050505;
            --glass: rgba(20, 20, 20, 0.75);
            --border: rgba(255, 159, 26, 0.3);
            --text: #fff;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –§–û–ù --- */
        #bg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden; pointer-events: none;
        }
        .fly-item {
            position: absolute; background-size: cover; opacity: 0;
            animation: flyAnim linear forwards; border-radius: 50%;
            filter: grayscale(0.5);
        }
        @keyframes flyAnim {
            0% { transform: translateY(110vh) rotate(0deg) scale(0.5); opacity: 0; }
            20% { opacity: 0.15; }
            80% { opacity: 0.15; }
            100% { transform: translateY(-20vh) rotate(360deg) scale(1.2); opacity: 0; }
        }

        /* --- –ò–ù–¢–ï–†–§–ï–ô–° --- */
        .header {
            width: 92%; margin-top: 10px; padding: 12px;
            background: var(--glass); border-radius: 16px;
            border: 1px solid var(--border);
            backdrop-filter: blur(12px);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 10;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .balance-box { display: flex; flex-direction: column; }
        .bal-label { font-size: 10px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
        .balance { font-size: 26px; font-weight: 900; color: var(--primary); text-shadow: 0 0 15px rgba(255,159,26,0.3); }
        
        .stats-box { text-align: right; font-size: 11px; color: #ccc; }
        .stat-row b { color: var(--primary); }

        /* –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê */
        .game-area {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; width: 100%;
            position: relative; z-index: 5;
        }

        .gor-skin {
            width: 280px; height: 280px; border-radius: 50%;
            border: 4px solid var(--primary);
            background-image: url('img/gor1.png');
            background-size: cover; background-position: center;
            box-shadow: 0 0 40px rgba(255, 159, 26, 0.2);
            transition: transform 0.08s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer; position: relative;
        }
        .gor-skin:active { transform: scale(0.94); }

        /* –Ø–†–û–°–¢–¨ */
        .rage-bar-wrap {
            width: 80%; height: 44px; margin-top: 30px;
            background: #222; border-radius: 12px;
            position: relative; overflow: hidden;
            border: 1px solid #444; transition: all 0.3s;
        }
        .rage-fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, #ff3838, #ff9f1a);
            transition: width 0.2s linear;
        }
        .rage-text {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            font-weight: 800; font-size: 14px; letter-spacing: 1px;
            text-shadow: 0 1px 3px black; z-index: 2;
        }
        .rage-ready { border-color: var(--accent); box-shadow: 0 0 25px rgba(255, 56, 56, 0.6); animation: pulse 1s infinite; cursor: pointer; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        /* –ú–ê–ì–ê–ó–ò–ù */
        .shop-container {
            width: 100%; height: 45%;
            background: rgba(15, 15, 15, 0.95);
            border-top: 2px solid var(--primary);
            border-radius: 25px 25px 0 0;
            padding: 20px; box-sizing: border-box;
            overflow-y: auto; z-index: 20;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
        }
        .shop-title { margin: 0 0 15px 0; font-size: 18px; color: #fff; display: flex; justify-content: space-between; }
        .withdraw-btn { background: #2ecc71; color: #000; font-size: 12px; padding: 5px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; }

        .item-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; padding: 12px;
            margin-bottom: 10px; display: flex;
            justify-content: space-between; align-items: center;
            transition: background 0.2s;
        }
        .item-card:active { background: rgba(255,255,255,0.08); }
        .item-info h4 { margin: 0; font-size: 15px; color: var(--primary); }
        .item-info p { margin: 4px 0 0; font-size: 11px; color: #888; }
        
        .buy-btn {
            background: var(--primary); border: none; padding: 8px 14px;
            border-radius: 8px; font-weight: 700; font-size: 13px; color: #000;
            min-width: 70px; cursor: pointer;
        }
        .buy-btn:disabled { background: #333; color: #555; cursor: not-allowed; }
        
        /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∏—Å–∫–∞ */
        .toggle-btn {
            padding: 8px 14px; border-radius: 8px; font-weight: 700; font-size: 12px;
            border: none; cursor: pointer; transition: all 0.2s;
        }
        .toggle-btn.on { background: #2ecc71; color: #000; box-shadow: 0 0 10px #2ecc71; }
        .toggle-btn.off { background: #444; color: #aaa; }

        .max-badge { background: #2ecc71; color: #000; font-size: 12px; padding: 5px 10px; border-radius: 6px; font-weight: bold; }

        /* –≠–§–§–ï–ö–¢–´ */
        .float-txt {
            position: absolute; font-weight: 900; font-size: 24px;
            color: #fff; pointer-events: none;
            animation: floatText 0.8s forwards; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        .float-txt.crit { color: var(--accent); font-size: 32px; z-index: 100; }
        @keyframes floatText { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.5); opacity: 0; } }

        #jumpscare {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 9999; flex-direction: column; justify-content: center; align-items: center;
        }
        #jumpscare img { width: 100%; height: 100%; object-fit: cover; position: absolute; }
        .scam-text { position: relative; color: red; font-size: 40px; font-weight: 900; z-index: 10; text-shadow: 0 0 20px black; }

        body.rage-active { background: #3b0000; }
        body.rage-active .gor-skin { border-color: red; animation: shakeSkin 0.1s infinite; }
        @keyframes shakeSkin { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }

    </style>
</head>
<body>

    <audio id="sClick" src="sounds/click.mp3"></audio>
    <audio id="sBuy" src="sounds/buy.mp3"></audio>
    <audio id="sRage" src="sounds/rage.mp3"></audio>
    <audio id="sScream" src="sounds/scream.mp3"></audio>

    <div id="bg-layer"></div>

    <div id="jumpscare">
        <img src="img/gor_scary.png">
        <div class="scam-text" id="lossText">SCAM!</div>
    </div>

    <div class="header">
        <div class="balance-box">
            <span class="bal-label">–¢–≤–æ–π –ë–∞–ª–∞–Ω—Å</span>
            <span class="balance" id="bal">0</span>
        </div>
        <div class="stats-box">
            <div class="stat-row">–ö–ª–∏–∫: <b id="dmgVal">1</b></div>
            <div class="stat-row">–ê–≤—Ç–æ: <b id="cpsVal">0</b>/c</div>
        </div>
    </div>

    <div class="game-area">
        <div class="gor-skin" id="skin" onclick="doClick(event)"></div>

        <div class="rage-bar-wrap" id="rageWrap" onclick="tryActivateRage()">
            <div class="rage-fill" id="rageFill"></div>
            <div class="rage-text" id="rageText">–Ø–†–û–°–¢–¨ 0%</div>
        </div>
    </div>

    <div class="shop-container">
        <h3 class="shop-title">
            üõí –ú–∞–≥–∞–∑–∏–Ω
            <div class="withdraw-btn" onclick="withdraw()">üì• –í –ë–û–¢–ê</div>
        </h3>
        <div id="shopList"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let state = {
            bal: 0,
            clicks: 0,
            rage: 0,
            rageActive: false,
            riskActive: false, // –§–ª–∞–≥ –≤–∫–ª—é—á–µ–Ω –ª–∏ —Ä–∏—Å–∫
            upgrades: {
                gym:     { lvl: 0, cost: 50,    base: 1, name: "üí™ –ì–∞–Ω—Ç–µ–ª—è", desc: "+1 —É—Ä–æ–Ω –∑–∞ –∫–ª–∏–∫" },
                drink:   { lvl: 0, cost: 300,   base: 5, name: "‚ö°Ô∏è –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫", desc: "+5 —É—Ä–æ–Ω –∑–∞ –∫–ª–∏–∫" },
                auto1:   { lvl: 0, cost: 200,   base: 2, name: "ü•ô –®–∞—É—Ä–º–∞", desc: "–ê–≤—Ç–æ-–¥–æ—Ö–æ–¥ +2/—Å–µ–∫" },
                slipper: { lvl: 0, cost: 1500,  mult: 1.5, name: "ü©¥ –¢–∞–ø–æ–∫ –°—É–¥—å–±—ã", desc: "–ú–Ω–æ–∂–∏—Ç–µ–ª—å –∫–ª–∏–∫–∞ x1.5" },
                auto2:   { lvl: 0, cost: 5000,  base: 50, name: "üè≠ –ó–∞–≤–æ–¥ –ö–ª–æ–Ω–æ–≤", desc: "–ê–≤—Ç–æ-–¥–æ—Ö–æ–¥ +50/—Å–µ–∫" },
                tax:     { lvl: 0, cost: 10000, mult: 1.2, name: "üí∏ –£—Ö–æ–¥ –æ—Ç –Ω–∞–ª–æ–≥–æ–≤", desc: "–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ +20%" },
                crit:    { lvl: 0, cost: 750,   chance: 0.1, name: "üéØ –í–æ—Ä –®–∞–º–ø—É—Ä–æ–≤", desc: "10% —à–∞–Ω—Å –Ω–∞ –∫—Ä–∏—Ç x10" },
                risk:    { lvl: 0, cost: 666,   name: "‚ò†Ô∏è –û–ø–∞—Å–Ω—ã–π x5", desc: "–í–ö–õ/–í–´–ö–õ: x5, –Ω–æ —Ä–∏—Å–∫ —Å–∫—Ä–∏–º–µ—Ä–∞", max: 1 }
            }
        };

        const urlP = new URLSearchParams(window.location.search);
        let startBal = parseInt(urlP.get('bal')) || 0;
        let local = localStorage.getItem('goram_v39_2'); // –ù–æ–≤—ã–π —Å–µ–π–≤
        if(local) {
            try { 
                let p = JSON.parse(local);
                state = {...state, ...p, upgrades: {...state.upgrades, ...p.upgrades}};
            } catch(e){}
        }
        if (startBal > state.bal) state.bal = startBal;

        const aud = {
            click: document.getElementById('sClick'),
            buy: document.getElementById('sBuy'),
            rage: document.getElementById('sRage'),
            scam: document.getElementById('sScream')
        };

        function spawnFly() {
            const bg = document.getElementById('bg-layer');
            const el = document.createElement('div');
            el.className = 'fly-item';
            el.style.backgroundImage = `url('img/gor${Math.ceil(Math.random()*3)}.png')`;
            el.style.left = Math.random()*90 + '%';
            let s = 40 + Math.random()*80;
            el.style.width = s+'px'; el.style.height = s+'px';
            el.style.animationDuration = (8 + Math.random()*10) + 's';
            bg.appendChild(el);
            setTimeout(()=>el.remove(), 18000);
        }
        setInterval(spawnFly, 2500);

        function getClickPower() {
            let u = state.upgrades;
            let base = 1 + u.gym.lvl * 1 + u.drink.lvl * 5;
            if (u.slipper.lvl > 0) base *= Math.pow(1.5, u.slipper.lvl);
            
            // –ü–†–ò–ú–ï–ù–Ø–ï–ú X5 –¢–û–õ–¨–ö–û –ï–°–õ–ò –í–ö–õ–Æ–ß–ï–ù–ê –ö–ù–û–ü–ö–ê
            if (u.risk.lvl > 0 && state.riskActive) base *= 5;
            
            if (state.rageActive) base *= 2;
            return Math.floor(base);
        }

        function getAutoPower() {
            let u = state.upgrades;
            let base = u.auto1.lvl * 2 + u.auto2.lvl * 50;
            if (u.tax.lvl > 0) base *= Math.pow(1.2, u.tax.lvl);
            return Math.floor(base);
        }

        function doClick(e) {
            let dmg = getClickPower();
            let isCrit = false;

            if (state.upgrades.crit.lvl > 0 && Math.random() < 0.1) {
                dmg *= 10; isCrit = true;
            }

            // –õ–û–ì–ò–ö–ê –°–ö–†–ò–ú–ï–†–ê (–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∏—Å–∫ –∫—É–ø–ª–µ–Ω, –≤–∫–ª—é—á–µ–Ω –∏ –Ω–µ—Ç —è—Ä–æ—Å—Ç–∏)
            if (state.upgrades.risk.lvl > 0 && state.riskActive && !state.rageActive && state.clicks % 3 === 0) {
                if(Math.random() < 0.15) {
                    triggerScam(); return;
                }
            }

            state.bal += dmg;
            state.clicks++;
            
            if(!state.rageActive) {
                state.rage += 1.5;
                if(state.rage > 100) state.rage = 100;
            }

            spawnFloat(e.clientX, e.clientY, `+${dmg}`, isCrit);
            tg.HapticFeedback.impactOccurred(isCrit ? 'heavy' : 'light');
            
            if(Math.random() < 0.3) {
                aud.click.currentTime = 0; aud.click.play().catch(()=>{});
            }

            render();
        }

        function spawnFloat(x, y, txt, crit) {
            let el = document.createElement('div');
            el.className = 'float-txt' + (crit ? ' crit' : '');
            el.innerText = txt;
            el.style.left = (x-20)+'px'; el.style.top = (y-50)+'px';
            document.body.appendChild(el);
            setTimeout(()=>el.remove(), 800);
        }

        function triggerScam() {
            let loss = Math.floor(state.bal * 0.65);
            state.bal -= loss;
            document.getElementById('lossText').innerText = `-${loss}`;
            document.getElementById('jumpscare').style.display = 'flex';
            aud.scam.play().catch(()=>{});
            tg.HapticFeedback.notificationOccurred('error');
            setTimeout(()=>{
                document.getElementById('jumpscare').style.display = 'none';
                render();
            }, 1500);
        }

        function tryActivateRage() {
            if(state.rage < 100 || state.rageActive) return;
            state.rageActive = true;
            state.rage = 0;
            document.body.classList.add('rage-active');
            aud.rage.play().catch(()=>{});
            tg.HapticFeedback.notificationOccurred('warning');
            render();
            setTimeout(()=>{
                state.rageActive = false;
                document.body.classList.remove('rage-active');
                render();
            }, 10000);
        }

        // --- –ú–ê–ì–ê–ó–ò–ù –ò –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ ---
        function buy(k) {
            let u = state.upgrades[k];
            let price = Math.floor(u.cost * Math.pow(1.5, u.lvl));
            if(state.bal >= price) {
                state.bal -= price;
                u.lvl++;
                aud.buy.play().catch(()=>{});
                render();
            }
        }

        function toggleRisk() {
            state.riskActive = !state.riskActive;
            tg.HapticFeedback.selectionChanged();
            render();
        }

        function render() {
            document.getElementById('bal').innerText = Math.floor(state.bal);
            document.getElementById('dmgVal').innerText = getClickPower();
            document.getElementById('cpsVal').innerText = getAutoPower();

            let rBar = document.getElementById('rageFill');
            let rTxt = document.getElementById('rageText');
            let rWrap = document.getElementById('rageWrap');
            rBar.style.width = state.rage + '%';
            if(state.rageActive) {
                rTxt.innerText = "üî• –Ø–†–û–°–¢–¨ –ê–ö–¢–ò–í–ù–ê üî•";
                rWrap.classList.remove('rage-ready');
            } else if (state.rage >= 100) {
                rTxt.innerText = "–ñ–ú–ò –°–Æ–î–ê!";
                rWrap.classList.add('rage-ready');
            } else {
                rTxt.innerText = `–Ø–†–û–°–¢–¨ ${Math.floor(state.rage)}%`;
                rWrap.classList.remove('rage-ready');
            }

            let list = document.getElementById('shopList');
            list.innerHTML = '';
            for(let k in state.upgrades) {
                let u = state.upgrades[k];
                let price = Math.floor(u.cost * Math.pow(1.5, u.lvl));
                let isMax = u.max && u.lvl >= u.max;

                // –°–ü–ï–¶–ò–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –î–õ–Ø "–û–ü–ê–°–ù–´–ô X5"
                let buttonHtml = '';
                
                if (k === 'risk' && u.lvl > 0) {
                    // –ï—Å–ª–∏ —Ä–∏—Å–∫ –∫—É–ø–ª–µ–Ω -> –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
                    let btnClass = state.riskActive ? 'toggle-btn on' : 'toggle-btn off';
                    let btnText = state.riskActive ? '–í–ö–õ–Æ–ß–ï–ù–û ‚úÖ' : '–í–´–ö–õ–Æ–ß–ï–ù–û ‚ùå';
                    buttonHtml = `<button class="${btnClass}" onclick="toggleRisk()">${btnText}</button>`;
                } else {
                    // –û–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏
                    if (isMax) {
                        buttonHtml = '<span class="max-badge">MAX</span>';
                    } else {
                        let disabled = state.bal < price ? 'disabled' : '';
                        buttonHtml = `<button class="buy-btn" onclick="buy('${k}')" ${disabled}>${price}</button>`;
                    }
                }

                let div = document.createElement('div');
                div.className = 'item-card';
                div.innerHTML = `
                    <div class="item-info">
                        <h4>${u.name} <span style="color:#fff; opacity:0.5; font-size:11px">Lvl ${u.lvl}</span></h4>
                        <p>${u.desc}</p>
                    </div>
                    ${buttonHtml}
                `;
                list.appendChild(div);
            }
            
            localStorage.setItem('goram_v39_2', JSON.stringify(state));
        }

        function withdraw() {
            let val = Math.floor(state.bal);
            if(val<=0) return;
            tg.showConfirm(`–í—ã–≤–µ—Å—Ç–∏ ${val} –∑–≤–µ–∑–¥?`, ok=>{
                if(ok) tg.sendData(JSON.stringify({action:'game_result', profit:val}));
            });
        }

        setInterval(()=>{
            let gain = getAutoPower();
            if(gain > 0) { state.bal += gain; render(); }
        }, 1000);

        render();
        spawnFly(); spawnFly();
    </script>
</body>
</html>
