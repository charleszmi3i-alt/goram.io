<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GorAM App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #f39c12; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π –ì–æ—Ä–∞ */
            --secondary: #e74c3c; /* –ö—Ä–∞—Å–Ω—ã–π */
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --text: #ffffff;
        }

        body {
            background: linear-gradient(135deg, var(--bg-dark), #2c1e1e); /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω —Å –æ—Ç—Ç–µ–Ω–∫–æ–º */
            color: var(--text);
            font-family: 'Montserrat', sans-serif; /* –ë–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç */
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –û–ë–©–ò–ï –≠–õ–ï–ú–ï–ù–¢–´ --- */
        h1, h2 { margin: 0 0 15px 0; text-align: center; text-transform: uppercase; letter-spacing: 1px; }
        h1 { color: var(--primary); text-shadow: 0 0 15px rgba(243, 156, 18, 0.4); }

        .header-balance {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .container {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        .container.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background: linear-gradient(to right, var(--primary), var(--secondary)); box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4); }
        .btn-danger { background: linear-gradient(to right, #c0392b, #962d22); }
        .btn-back { background: rgba(255, 255, 255, 0.1); margin-bottom: 20px; width: auto; padding: 10px 20px; }

        /* --- –ú–ï–ù–Æ --- */
        .menu-grid { display: grid; gap: 15px; }
        .menu-item {
            background: var(--bg-card); border: 2px solid rgba(255, 255, 255, 0.05);
            padding: 20px; border-radius: 20px; text-align: center; cursor: pointer;
            transition: all 0.3s;
        }
        .menu-item:hover { border-color: var(--primary); transform: translateY(-5px); }
        .menu-icon { font-size: 40px; margin-bottom: 10px; }

        /* --- –°–õ–û–¢–´ –° –§–û–¢–û --- */
        .slot-machine-container {
            background: #000; border-radius: 15px; padding: 15px;
            border: 3px solid var(--primary);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            overflow: hidden; margin-bottom: 20px;
        }
        .slots-window {
            display: flex; gap: 10px; height: 120px; /* –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ç–æ */
            overflow: hidden;
            mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 80%, transparent 100%);
        }
        .reel-column {
            flex: 1; position: relative;
            transform: translateY(0); /* –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è */
        }
        /* –ö–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—Ä–∞—â–µ–Ω–∏—è */
        .reel-column.spinning { transition: transform 2.5s cubic-bezier(0.25, 0.1, 0.25, 1); }

        .reel-image {
            width: 100%; height: 120px; /* –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Ñ–æ—Ç–æ */
            background-size: cover; background-position: center;
            border-radius: 10px; border: 2px solid rgba(255,255,255,0.1);
            box-sizing: border-box; display: flex; align-items: center; justify-content: center;
            font-size: 40px; /* –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ –≥—Ä—É–∑–∏—Ç */
        }

        /* --- –ú–ò–ù–´ --- */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 20px; }
        .mine-tile {
            aspect-ratio: 1; background: rgba(255, 255, 255, 0.1); border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer; border: 2px solid transparent;
            transition: all 0.2s;
        }
        .mine-tile:active { background: rgba(255, 255, 255, 0.2); }
        .mine-tile.revealed.safe { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }
        .mine-tile.revealed.bomb { background: var(--secondary); box-shadow: 0 0 15px var(--secondary); }
        .bet-controls { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 15px; }
        .bet-input { flex: 1; background: transparent; border: none; color: white; font-size: 20px; text-align: center; font-weight: bold; }
        .multiplier-display { text-align: center; font-size: 24px; color: var(--primary); margin-bottom: 20px; height: 30px; }

    </style>
</head>
<body>

    <audio id="sndClick" src="sounds/click.mp3"></audio>
    <audio id="sndSpin" src="sounds/spin.mp3"></audio>
    <audio id="sndWin" src="sounds/win.mp3"></audio>
    <audio id="sndMine" src="sounds/mine.mp3"></audio>

    <div class="header-balance">
        üí∞ –ë–∞–ª–∞–Ω—Å: <span id="userBalance">–ó–∞–≥—Ä—É–∑–∫–∞...</span> –∑–≤.
    </div>

    <div class="container active" id="menuView">
        <h1>GorAM Hub</h1>
        <div class="menu-grid">
            <div class="menu-item" onclick="showView('slotsView')">
                <div class="menu-icon">üé∞</div>
                <h2>Gor Slots</h2>
                <p>–ö—Ä—É—Ç–∏ —Ñ–æ—Ç–æ –ª–µ–≥–µ–Ω–¥—ã</p>
            </div>
            <div class="menu-item" onclick="showView('minesView')">
                <div class="menu-icon">üí£</div>
                <h2>–ú–∏–Ω—ã</h2>
                <p>–ü—Ä–æ–≤–µ—Ä—å —É–¥–∞—á—É</p>
            </div>
        </div>
    </div>

    <div class="container" id="slotsView">
        <button class="btn btn-back" onclick="showView('menuView')">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
        <h1>üì∏ Gor Slots üì∏</h1>
        
        <div class="slot-machine-container">
            <div class="slots-window">
                <div class="reel-column" id="reelCol1"></div>
                <div class="reel-column" id="reelCol2"></div>
                <div class="reel-column" id="reelCol3"></div>
            </div>
        </div>

        <div class="bet-controls">
            <button class="btn btn-back" onclick="changeSlotBet(-50)">-</button>
            <input type="number" class="bet-input" id="slotBetInput" value="100" readonly>
            <button class="btn btn-back" onclick="changeSlotBet(50)">+</button>
        </div>

        <button class="btn btn-primary" id="spinBtn" onclick="spinSlots()">üé∞ –ö–†–£–¢–ò–¢–¨!</button>
        <h2 id="slotStatus" style="height: 30px;">–£–¥–∞—á–∏!</h2>
    </div>

    <div class="container" id="minesView">
         <button class="btn btn-back" onclick="showView('menuView')">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
        <h1>üí£ –ú–ò–ù–´</h1>
        
        <div class="bet-controls">
            –°—Ç–∞–≤–∫–∞: <input type="number" class="bet-input" id="mineBetInput" value="100">
            –ú–∏–Ω—ã: <select class="bet-input" id="minesCount"><option value="3">3</option><option value="5">5</option><option value="10">10</option></select>
        </div>
        
        <div class="multiplier-display" id="mineMult">x1.00</div>

        <div class="mines-grid" id="minesGrid">
            </div>

        <button class="btn btn-primary" id="mineStartBtn" onclick="startMines()">‚ñ∂Ô∏è –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
        <button class="btn btn-primary" id="mineCashoutBtn" style="display: none;" onclick="cashoutMines()">üí∞ –ó–ê–ë–†–ê–¢–¨ (<span id="cashoutAmount">0</span>)</button>
    </div>


    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // --- –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ---
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL (–∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—Å—Ç –±–æ—Ç)
        const urlParams = new URLSearchParams(window.location.search);
        let userId = urlParams.get('uid') || 'test_user';
        let balance = parseInt(urlParams.get('bal')) || 1000; // –ë–∞–ª–∞–Ω—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–µ—Å—Ç–∞

        const balanceEl = document.getElementById('userBalance');
        
        function updateBalanceDisplay() {
            balanceEl.innerText = balance;
            tg.HapticFeedback.selectionChanged();
        }
        updateBalanceDisplay();

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–æ—Ç—É
        function sendResultToBot(game, profit) {
            balance += profit;
            updateBalanceDisplay();
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É, —á—Ç–æ–±—ã –æ–Ω –∑–∞–ø–∏—Å–∞–ª –∏—Ö –≤ –ë–î
            const data = JSON.stringify({ action: 'game_result', game: game, profit: profit, uid: userId });
            tg.sendData(data);
        }

        // –ó–í–£–ö–ò
        const sClick = document.getElementById('sndClick');
        const sSpin = document.getElementById('sndSpin');
        const sWin = document.getElementById('sndWin');
        const sMine = document.getElementById('sndMine');
        function play(snd) { snd.currentTime = 0; snd.play().catch(()=>{}); } // catch –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –∑–≤—É–∫

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        function showView(viewId) {
            play(sClick);
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            if(viewId === 'slotsView') initSlotsUI(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ –ø—Ä–∏ –≤—Ö–æ–¥–µ
        }

        // ================= –õ–û–ì–ò–ö–ê –°–õ–û–¢–û–í (–° –§–û–¢–û) =================
        // –ü—É—Ç–∏ –∫ —Ç–≤–æ–∏–º —Ñ–æ—Ç–æ –≤ –ø–∞–ø–∫–µ img/
        const gorPhotos = [
            'img/gor1.png', // –û–±—ã—á–Ω—ã–π
            'img/gor2.png', // –†–µ–¥–∫–∏–π
            'img/gor3.png', // –≠–ø–∏–∫
            'img/gor_wild.png' // –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π (–í–∞–π–ª–¥)
        ];
        const IMG_HEIGHT = 120; // –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏
        const SYMBOLS_PER_REEL = 30; // –°–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ "–ª–µ–Ω—Ç–µ" –±–∞—Ä–∞–±–∞–Ω–∞ (–¥–ª—è –¥–æ–ª–≥–æ–≥–æ —Å–ø–∏–Ω–∞)

        let isSpinning = false;
        const slotBetInput = document.getElementById('slotBetInput');
        const slotStatus = document.getElementById('slotStatus');
        const spinBtnEl = document.getElementById('spinBtn');
        const reelCols = [document.getElementById('reelCol1'), document.getElementById('reelCol2'), document.getElementById('reelCol3')];

        function changeSlotBet(amount) {
             play(sClick);
             let current = parseInt(slotBetInput.value);
             if (current + amount > 0) slotBetInput.value = current + amount;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞—Ä–∞–±–∞–Ω—ã –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏
        function initSlotsUI() {
            reelCols.forEach(col => {
                col.innerHTML = '';
                col.classList.remove('spinning');
                col.style.transform = 'translateY(0px)';
                // –°–æ–∑–¥–∞–µ–º –¥–ª–∏–Ω–Ω—É—é –ª–µ–Ω—Ç—É –∏–∑ —Å–ª—É—á–∞–π–Ω—ã—Ö —Ñ–æ—Ç–æ –ì–æ—Ä–∞
                for (let i = 0; i < SYMBOLS_PER_REEL; i++) {
                    const imgDiv = document.createElement('div');
                    imgDiv.className = 'reel-image';
                    const randomPhoto = gorPhotos[Math.floor(Math.random() * gorPhotos.length)];
                    imgDiv.style.backgroundImage = `url('${randomPhoto}')`;
                    col.appendChild(imgDiv);
                }
            });
        }

        function spinSlots() {
            const bet = parseInt(slotBetInput.value);
            if (balance < bet || isSpinning) return;
            
            isSpinning = true;
            sendResultToBot('slots_bet', -bet); // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            spinBtnEl.disabled = true;
            slotStatus.innerText = "–ö—Ä—É—Ç–∏–º –ì–æ—Ä–∞...";
            slotStatus.style.color = "white";
            play(sSpin);

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ó–ê–†–ê–ù–ï–ï (–ø–æ–¥–∫—Ä—É—Ç–∫–∞ –¥–ª—è –¥–µ–º–æ, –≤ —Ä–µ–∞–ª–µ - —á–µ—Å—Ç–Ω—ã–π —Ä–∞–Ω–¥–æ–º)
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 3 –∫–æ–Ω–µ—á–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–∞ —Ñ–æ—Ç–æ
            const finalIndices = [
                Math.floor(Math.random() * gorPhotos.length),
                Math.floor(Math.random() * gorPhotos.length),
                Math.floor(Math.random() * gorPhotos.length)
            ];

            reelCols.forEach((col, i) => {
                // –ü–æ–¥–º–µ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ –ª–µ–Ω—Ç–µ –Ω–∞ —Ç—É, —á—Ç–æ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–∞—Å—Ç—å
                const lastImgIndex = SYMBOLS_PER_REEL - 1; // –¢–∞, —á—Ç–æ –±—É–¥–µ—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤ –∫–æ–Ω—Ü–µ
                const targetPhotoUrl = gorPhotos[finalIndices[i]];
                col.children[lastImgIndex].style.backgroundImage = `url('${targetPhotoUrl}')`;

                // –í—ã—á–∏—Å–ª—è–µ–º, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –ø–∏–∫—Å–µ–ª–µ–π —Å–¥–≤–∏–Ω—É—Ç—å –ª–µ–Ω—Ç—É –≤–≤–µ—Ä—Ö
                // –°–¥–≤–∏–≥–∞–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω—è—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –≤ —Ü–µ–Ω—Ç—Ä–µ –æ–∫–Ω–∞ (–æ–∫–Ω–æ 120px, —Ü–µ–Ω—Ç—Ä –Ω–∞ 60px)
                 // –ü–æ–∑–∏—Ü–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏: (SYMBOLS_PER_REEL - 1) * IMG_HEIGHT
                 // –ù–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–∞ –≤—Å—Ç–∞–ª–∞ –≤ –ø–æ–∑–∏—Ü–∏—é Y = 0 –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–∫–Ω–∞
                const targetY = -((SYMBOLS_PER_REEL - 1) * IMG_HEIGHT);
                
                // –ó–∞–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
                setTimeout(() => {
                    col.classList.add('spinning');
                    col.style.transform = `translateY(${targetY}px)`;
                }, i * 300);
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ 2.5—Å + –∑–∞–¥–µ—Ä–∂–∫–∏)
            setTimeout(() => {
                checkSlotWin(finalIndices, bet);
                isSpinning = false;
                spinBtnEl.disabled = false;
                sSpin.pause();
            }, 2500 + 600);
        }

        function checkSlotWin(indices, bet) {
            tg.HapticFeedback.impactOccurred('heavy');
            const s1 = indices[0], s2 = indices[1], s3 = indices[2];
            let winMult = 0;

            // –õ–æ–≥–∏–∫–∞ –ø–æ–±–µ–¥ (–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è: 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö)
            if (s1 === s2 && s2 === s3) {
                // –ß–µ–º –±–æ–ª—å—à–µ –∏–Ω–¥–µ–∫—Å —Ñ–æ—Ç–æ –≤ –º–∞—Å—Å–∏–≤–µ gorPhotos, —Ç–µ–º –∫—Ä—É—á–µ –≤—ã–∏–≥—Ä—ã—à
                winMult = (s1 + 1) * 10; // x10, x20, x30, x40
                if (s1 === 3) { // –ï—Å–ª–∏ –≤—ã–ø–∞–ª Wild (gor_wild.png)
                     winMult = 100; // –î–ñ–ï–ö–ü–û–¢ x100
                     slotStatus.innerText = "üî• GOR LEGENDARY JACKPOT! üî•";
                     slotStatus.style.color = "var(--secondary)";
                } else {
                    slotStatus.innerText = `‚úÖ –¢—Ä–æ–π–Ω–æ–π –ì–æ—Ä! –í—ã–∏–≥—Ä—ã—à: ${bet * winMult}`;
                    slotStatus.style.color = "var(--primary)";
                }
                play(sWin);
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                slotStatus.innerText = "–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.";
            }

            if (winMult > 0) {
                sendResultToBot('slots_win', bet * winMult);
            }
        }


        // ================= –õ–û–ì–ò–ö–ê –ú–ò–ù =================
        const minesGrid = document.getElementById('minesGrid');
        const mineBetInput = document.getElementById('mineBetInput');
        const minesCountSelect = document.getElementById('minesCount');
        const mineStartBtn = document.getElementById('mineStartBtn');
        const mineCashoutBtn = document.getElementById('mineCashoutBtn');
        const mineMultEl = document.getElementById('mineMult');
        const cashoutAmountEl = document.getElementById('cashoutAmount');

        let mineGameActive = false;
        let mineMap = [];
        let currentMineBet = 0;
        let steps = 0;
        let currentMult = 1.0;

        function initMinesGrid() {
            minesGrid.innerHTML = '';
            for(let i=0; i<25; i++) {
                const tile = document.createElement('div');
                tile.className = 'mine-tile';
                tile.dataset.index = i;
                tile.innerText = '‚ùì';
                tile.onclick = () => tileClick(i);
                minesGrid.appendChild(tile);
            }
        }
        initMinesGrid(); // –°—Ä–∞–∑—É —Ä–∏—Å—É–µ–º –ø–æ–ª–µ

        function startMines() {
            const bet = parseInt(mineBetInput.value);
            if (balance < bet || mineGameActive) return;
            play(sClick);

            currentMineBet = bet;
            sendResultToBot('mines_bet', -bet);
            mineGameActive = true;
            steps = 0;
            currentMult = 1.0;
            mineMultEl.innerText = "x1.00";
            
            mineStartBtn.style.display = 'none';
            mineCashoutBtn.style.display = 'inline-flex';
            mineBetInput.disabled = true;
            minesCountSelect.disabled = true;

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω
            const minesCount = parseInt(minesCountSelect.value);
            mineMap = Array(25).fill('safe');
            let placed = 0;
            while(placed < minesCount) {
                let idx = Math.floor(Math.random() * 25);
                if(mineMap[idx] === 'safe') { mineMap[idx] = 'bomb'; placed++; }
            }

            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ
            document.querySelectorAll('.mine-tile').forEach(t => {
                t.className = 'mine-tile';
                t.innerText = '‚ùì';
            });
        }

        function tileClick(idx) {
            if(!mineGameActive) return;
            const tile = minesGrid.children[idx];
            if(tile.classList.contains('revealed')) return;

            tg.HapticFeedback.impactOccurred('light');

            if(mineMap[idx] === 'bomb') {
                // –í–ó–†–´–í
                play(sMine);
                tile.classList.add('revealed', 'bomb');
                tile.innerText = 'üí•';
                gameOverMines(false);
            } else {
                // –ë–ï–ó–û–ü–ê–°–ù–û
                play(sClick);
                tile.classList.add('revealed', 'safe');
                tile.innerText = 'üíé';
                steps++;
                calculateMult();
            }
        }

        function calculateMult() {
             const mines = parseInt(minesCountSelect.value);
             // –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è. –ß–µ–º –±–æ–ª—å—à–µ –º–∏–Ω –∏ —à–∞–≥–æ–≤, —Ç–µ–º –≤—ã—à–µ.
             // (–≠—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞, –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞–∑–∏–Ω–æ —Å–ª–æ–∂–Ω–µ–µ)
             let stepMult = 1.0 + (mines / 25) * 1.5; 
             currentMult *= stepMult;
             
             mineMultEl.innerText = `x${currentMult.toFixed(2)}`;
             cashoutAmountEl.innerText = Math.floor(currentMineBet * currentMult);
        }

        function cashoutMines() {
            if(!mineGameActive || steps === 0) return;
            play(sWin);
            const win = Math.floor(currentMineBet * currentMult);
            sendResultToBot('mines_win', win);
            gameOverMines(true);
        }

        function gameOverMines(won) {
            mineGameActive = false;
            mineStartBtn.style.display = 'inline-flex';
            mineCashoutBtn.style.display = 'none';
            mineBetInput.disabled = false;
            minesCountSelect.disabled = false;

            if (won) {
                tg.HapticFeedback.notificationOccurred('success');
                mineMultEl.innerText = `–ó–ê–ë–†–ê–õ: ${Math.floor(currentMineBet * currentMult)}`;
            } else {
                tg.HapticFeedback.notificationOccurred('error');
                mineMultEl.innerText = "–í–ó–†–´–í!";
                 // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–∏–Ω—ã
                mineMap.forEach((type, idx) => {
                    if(type === 'bomb') {
                         minesGrid.children[idx].classList.add('revealed', 'bomb');
                         minesGrid.children[idx].innerText = 'üí£';
                    }
                });
            }
        }

    </script>
</body>
</html>