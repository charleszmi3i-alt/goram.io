<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GorAM Ultimate Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #ff9f1a;
            --danger: #ff3838;
            --bg: #0f0f0f;
            --glass: rgba(30, 30, 30, 0.85);
            --text: #fff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –õ–ï–¢–ê–Æ–©–ò–ï –ì–û–†–´ (–§–û–ù) --- */
        #background-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden; pointer-events: none;
        }
        .flying-gor {
            position: absolute;
            background-size: cover;
            opacity: 0.15;
            animation: floatUp linear infinite;
            border-radius: 50%;
        }
        @keyframes floatUp {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.2; }
            90% { opacity: 0.2; }
            100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; }
        }

        /* --- –ò–ù–¢–ï–†–§–ï–ô–° --- */
        .header {
            width: 90%; margin-top: 15px; padding: 15px;
            background: var(--glass); border-radius: 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 10;
        }
        .balance { font-size: 24px; font-weight: 800; color: var(--primary); text-shadow: 0 0 10px rgba(255, 159, 26, 0.4); }
        
        .game-area {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; width: 100%;
            position: relative; z-index: 5;
        }

        /* –°–∫–∏–Ω –ì–æ—Ä–∞ */
        .gor-skin {
            width: 260px; height: 260px; border-radius: 50%;
            border: 6px solid var(--primary);
            background-image: url('img/gor1.png');
            background-size: cover; background-position: center;
            box-shadow: 0 0 50px rgba(255, 159, 26, 0.3);
            transition: transform 0.05s; cursor: pointer;
        }
        .gor-skin:active { transform: scale(0.92); }

        /* –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞ (—Ü–∏—Ñ—Ä—ã) */
        .click-fx {
            position: absolute; font-weight: bold; font-size: 28px;
            pointer-events: none; animation: popUp 0.8s forwards;
            color: #fff; text-shadow: 0 2px 5px black;
        }
        .click-fx.crit { color: #ff3838; font-size: 36px; }
        @keyframes popUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-100px) scale(1.2); opacity: 0; } }

        /* –ö–Ω–æ–ø–∫–∞ –Ø–†–û–°–¢–ò */
        .rage-container {
            width: 80%; height: 40px; background: #333;
            border-radius: 20px; margin-top: 25px;
            position: relative; overflow: hidden;
            border: 2px solid #555;
        }
        .rage-fill {
            height: 100%; width: 0%; background: linear-gradient(90deg, #ff3838, #ff9f1a);
            transition: width 0.2s;
        }
        .rage-text {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; text-transform: uppercase; font-size: 14px;
            text-shadow: 0 1px 2px black;
        }
        .rage-container.active { border-color: red; box-shadow: 0 0 20px red; cursor: pointer; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* –ú–ê–ì–ê–ó–ò–ù */
        .shop-panel {
            width: 100%; height: 42%; background: var(--glass);
            border-top-left-radius: 30px; border-top-right-radius: 30px;
            padding: 20px; box-sizing: border-box; overflow-y: auto;
            backdrop-filter: blur(15px); border-top: 2px solid var(--primary);
            z-index: 20;
        }
        .shop-item {
            background: rgba(255,255,255,0.05); padding: 12px; margin-bottom: 10px;
            border-radius: 15px; display: flex; justify-content: space-between; align-items: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .shop-btn {
            background: var(--primary); border: none; padding: 10px 15px;
            border-radius: 10px; font-weight: bold; color: #000; cursor: pointer;
        }
        .shop-btn:disabled { background: #555; color: #888; }

        /* –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ */
        .withdraw-btn {
            background: #2ecc71; padding: 8px 15px; border-radius: 12px;
            color: white; font-weight: bold; font-size: 14px; cursor: pointer;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }

        /* –°–ö–†–ò–ú–ï–† */
        #jumpscare {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 9999; flex-direction: column;
            justify-content: center; align-items: center;
        }
        #jumpscare img { width: 100%; height: 100%; object-fit: cover; position: absolute; }
        #scary-text {
            position: relative; color: red; font-size: 40px; font-weight: 900;
            text-shadow: 0 0 10px black; z-index: 10000; text-align: center;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Ä–µ–∂–∏–º–∞ —è—Ä–æ—Å—Ç–∏ */
        body.rage-on { background: #3b0000; }
        body.rage-on .gor-skin { animation: shake 0.1s infinite; border-color: red; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }

    </style>
</head>
<body>

    <audio id="sndClick" src="sounds/click.mp3"></audio>
    <audio id="sndBuy" src="sounds/buy.mp3"></audio>
    <audio id="sndRage" src="sounds/rage.mp3"></audio>
    <audio id="sndScream" src="sounds/scream.mp3"></audio>

    <div id="background-layer"></div>

    <div id="jumpscare">
        <img src="img/gor_scary.png">
        <div id="scary-text">SCAMMED!</div>
    </div>

    <div class="header">
        <div class="balance">üí∞ <span id="bal">0</span></div>
        <div class="withdraw-btn" onclick="withdraw()">üì• –í –ë–û–¢–ê</div>
    </div>

    <div class="game-area">
        <div class="gor-skin" id="mainGor" onclick="clickAction(event)"></div>
        
        <div class="rage-container" id="rageBtn" onclick="activateRage()">
            <div class="rage-fill" id="rageFill"></div>
            <div class="rage-text" id="rageTxt">–Ø–†–û–°–¢–¨ 0%</div>
        </div>
    </div>

    <div class="shop-panel" id="shopList">
        </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // === –°–û–°–¢–û–Ø–ù–ò–ï ===
        let state = {
            balance: 0,
            clicks: 0,
            rageVal: 0,
            isRage: false,
            upgrades: {
                click: { lvl: 0, cost: 50, name: "–°–∏–ª–∞ —É–¥–∞—Ä–∞", desc: "+1 –∫ –∫–ª–∏–∫—É" },
                auto:  { lvl: 0, cost: 200, name: "–ê–≤—Ç–æ-–ì–æ—Ä", desc: "+2/—Å–µ–∫ (–ü–∞—Å—Å–∏–≤)" },
                crit:  { lvl: 0, cost: 750, name: "–í–æ—Ä –®–∞–º–ø—É—Ä–æ–≤", desc: "–®–∞–Ω—Å 10% –Ω–∞ x10 —É—Ä–æ–Ω" },
                speed: { lvl: 0, cost: 1000, name: "–£—Å–∫–æ—Ä–µ–Ω–∏–µ –Ø—Ä–æ—Å—Ç–∏", desc: "–Ø—Ä–æ—Å—Ç—å –∫–æ–ø–∏—Ç—Å—è x2 –±—ã—Å—Ç—Ä–µ–µ" },
                risk:  { lvl: 0, cost: 500, name: "–û–ø–∞—Å–Ω—ã–π x5", desc: "x5 –∫–ª–∏–∫, –Ω–æ —Ä–∏—Å–∫ —Å–∫—Ä–∏–º–µ—Ä–∞!", max: 1 }
            }
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞
        const urlParams = new URLSearchParams(window.location.search);
        let botBal = parseInt(urlParams.get('bal')) || 0;
        let saved = localStorage.getItem('goram_v38');
        if(saved) {
            try { 
                let p = JSON.parse(saved);
                state = {...state, ...p, upgrades: {...state.upgrades, ...p.upgrades}};
            } catch(e){}
        }
        // –°–∏–Ω—Ö—Ä–æ–Ω —Å –±–æ—Ç–æ–º (–µ—Å–ª–∏ —Ç–∞–º –±–æ–ª—å—à–µ)
        if (botBal > state.balance) state.balance = botBal;

        // –ó–≤—É–∫–∏
        const sounds = {
            click: document.getElementById('sndClick'),
            buy: document.getElementById('sndBuy'),
            rage: document.getElementById('sndRage'),
            scream: document.getElementById('sndScream')
        };

        // === –§–û–ù–û–í–´–ï –ì–û–†–´ ===
        function spawnFloatingGor() {
            const bg = document.getElementById('background-layer');
            const el = document.createElement('div');
            el.className = 'flying-gor';
            
            // –†–∞–Ω–¥–æ–º–Ω–∞—è —Ñ–æ—Ç–∫–∞ (1, 2 –∏–ª–∏ 3)
            const imgId = Math.floor(Math.random() * 3) + 1;
            el.style.backgroundImage = `url('img/gor${imgId}.png')`;
            
            // –†–∞–Ω–¥–æ–º–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –∏ —Ä–∞–∑–º–µ—Ä
            el.style.left = Math.random() * 90 + '%';
            const size = 50 + Math.random() * 100;
            el.style.width = size + 'px';
            el.style.height = size + 'px';
            el.style.animationDuration = (5 + Math.random() * 10) + 's';
            
            bg.appendChild(el);
            
            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è
            setTimeout(() => el.remove(), 15000);
        }
        setInterval(spawnFloatingGor, 2000); // –ö–∞–∂–¥—ã–µ 2 —Å–µ–∫ –Ω–æ–≤—ã–π –ì–æ—Ä

        // === –ö–õ–ò–ö ===
        function clickAction(e) {
            let power = 1 + state.upgrades.click.lvl;
            let isCrit = false;

            // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä
            if (state.upgrades.crit.lvl > 0 && Math.random() < 0.1) {
                power *= 10;
                isCrit = true;
            }

            // –û–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º (x5) –∏ –°–∫—Ä–∏–º–µ—Ä
            if (state.upgrades.risk.lvl > 0) {
                power *= 5;
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∫—Ä–∏–º–µ—Ä (–∫–∞–∂–¥—ã–µ 3 –∫–ª–∏–∫–∞, —à–∞–Ω—Å 15%)
                if (!state.isRage && state.clicks % 3 === 0 && Math.random() < 0.15) {
                    doScreamer();
                    return;
                }
            }

            // –Ø—Ä–æ—Å—Ç—å (x2)
            if (state.isRage) power *= 2;

            state.balance += power;
            state.clicks++;
            tg.HapticFeedback.impactOccurred(isCrit ? 'heavy' : 'light');

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ø—Ä–æ—Å—Ç–∏
            if (!state.isRage) {
                let fillRate = 1 + state.upgrades.speed.lvl;
                state.rageVal += fillRate;
                if(state.rageVal > 100) state.rageVal = 100;
            }

            // –í–∏–∑—É–∞–ª (+100)
            showFloatText(e.clientX, e.clientY, `+${power}`, isCrit);
            
            // –ó–≤—É–∫ (–Ω–µ –≤—Å–µ–≥–¥–∞, —á—Ç–æ–±—ã –Ω–µ –±–µ—Å–∏–ª–æ)
            if(Math.random() < 0.3) {
                sounds.click.currentTime = 0;
                sounds.click.play().catch(()=>{});
            }

            updateUI();
        }

        function showFloatText(x, y, txt, crit) {
            const el = document.createElement('div');
            el.className = 'click-fx' + (crit ? ' crit' : '');
            el.innerText = txt;
            el.style.left = (x - 20) + 'px';
            el.style.top = (y - 40) + 'px';
            document.body.appendChild(el);
            setTimeout(()=>el.remove(), 800);
        }

        // === –õ–û–ì–ò–ö–ê ===
        function doScreamer() {
            let loss = Math.floor(state.balance * 0.65);
            state.balance -= loss;
            
            document.getElementById('scary-text').innerText = `-${loss} –ó–í–ï–ó–î`;
            document.getElementById('jumpscare').style.display = 'flex';
            sounds.scream.play().catch(()=>{});
            tg.HapticFeedback.notificationOccurred('error');
            
            setTimeout(() => {
                document.getElementById('jumpscare').style.display = 'none';
                updateUI();
            }, 1500);
        }

        function activateRage() {
            if (state.rageVal < 100 || state.isRage) return;
            state.isRage = true;
            state.rageVal = 0;
            document.body.classList.add('rage-on');
            sounds.rage.play().catch(()=>{});
            tg.HapticFeedback.notificationOccurred('warning');
            updateUI();
            
            setTimeout(() => {
                state.isRage = false;
                document.body.classList.remove('rage-on');
                updateUI();
            }, 10000);
        }

        function buy(key) {
            let u = state.upgrades[key];
            let cost = Math.floor(u.cost * Math.pow(1.5, u.lvl));
            
            if (state.balance >= cost) {
                state.balance -= cost;
                u.lvl++;
                sounds.buy.play().catch(()=>{});
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('bal').innerText = Math.floor(state.balance);
            
            // –Ø—Ä–æ—Å—Ç—å
            const rFill = document.getElementById('rageFill');
            const rTxt = document.getElementById('rageTxt');
            const rBtn = document.getElementById('rageBtn');
            
            rFill.style.width = state.rageVal + '%';
            
            if(state.isRage) {
                rTxt.innerText = "üî• –Ø–†–û–°–¢–¨ –ê–ö–¢–ò–í–ù–ê üî•";
                rBtn.classList.remove('active');
            } else if (state.rageVal >= 100) {
                rTxt.innerText = "–ñ–ú–ò –î–õ–Ø –Ø–†–û–°–¢–ò!";
                rBtn.classList.add('active');
            } else {
                rTxt.innerText = `–Ø–†–û–°–¢–¨ ${state.rageVal}%`;
                rBtn.classList.remove('active');
            }

            // –ú–∞–≥–∞–∑–∏–Ω
            const list = document.getElementById('shopList');
            list.innerHTML = '';
            for(let key in state.upgrades) {
                let u = state.upgrades[key];
                let cost = Math.floor(u.cost * Math.pow(1.5, u.lvl));
                let isMax = u.max && u.lvl >= u.max;
                
                let div = document.createElement('div');
                div.className = 'shop-item';
                div.innerHTML = `
                    <div>
                        <div style="font-weight:bold; color:var(--primary)">${u.name} <span style="font-size:12px; color:#fff">Lvl ${u.lvl}</span></div>
                        <div style="font-size:11px; color:#aaa">${u.desc}</div>
                    </div>
                    <button class="shop-btn" onclick="buy('${key}')" ${(state.balance < cost || isMax) ? 'disabled' : ''}>
                        ${isMax ? 'MAX' : cost + 'üí∞'}
                    </button>
                `;
                list.appendChild(div);
            }
            
            localStorage.setItem('goram_v38', JSON.stringify(state));
        }

        function withdraw() {
            let amt = Math.floor(state.balance);
            if (amt <= 0) return;
            tg.showConfirm(`–í—ã–≤–µ—Å—Ç–∏ ${amt} –∑–≤–µ–∑–¥ –≤ –±–æ—Ç–∞?`, (ok) => {
                if(ok) {
                    tg.sendData(JSON.stringify({ action: 'game_result', profit: amt }));
                    // –ù–µ –æ–±–Ω—É–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é, —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –±—ã–ª–æ –∫–æ–ø–∏—Ç—å –¥–∞–ª—å—à–µ, 
                    // –∏–ª–∏ –º–æ–∂–Ω–æ –æ–±–Ω—É–ª–∏—Ç—å: state.balance = 0; updateUI();
                }
            });
        }

        // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
        setInterval(() => {
            if (state.upgrades.auto.lvl > 0) {
                state.balance += (state.upgrades.auto.lvl * 2);
                updateUI();
            }
        }, 1000);

        // –ò–Ω–∏—Ç
        updateUI();
        // –ü–µ—Ä–≤—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ –ì–æ—Ä—ã
        spawnFloatingGor(); spawnFloatingGor();

    </script>
</body>
</html>
