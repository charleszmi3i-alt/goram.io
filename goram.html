<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GorAM App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: #111; color: white; font-family: sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 10px;
        }
        .container { width: 100%; max-width: 400px; display: none; }
        .active { display: block; }
        
        .btn {
            background: #f39c12; border: none; padding: 15px; width: 100%; 
            border-radius: 12px; font-size: 18px; font-weight: bold; color: #000;
            margin: 10px 0; cursor: pointer;
        }
        .btn:active { transform: scale(0.95); }
        
        /* –ö–õ–ò–ö–ï–† */
        .gor-clicker {
            width: 250px; height: 250px; 
            border-radius: 50%; border: 5px solid #f39c12;
            background-image: url('img/gor1.png'); /* –§–û–¢–û –ì–û–†–ê */
            background-size: cover; background-position: center;
            margin: 20px auto; transition: transform 0.1s;
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.5);
        }
        .gor-clicker:active { transform: scale(0.9); }

        /* –ú–ò–ù–´ */
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin: 20px 0; }
        .cell {
            aspect-ratio: 1; background: #333; border-radius: 5px; 
            display: flex; align-items: center; justify-content: center; font-size: 20px;
        }
        .cell.safe { background: #2ecc71; }
        .cell.bomb { background: #e74c3c; }
        
        .balance { font-size: 20px; margin-bottom: 20px; color: #f39c12; font-weight: bold; }
    </style>
</head>
<body>

    <div class="balance">üí∞ <span id="bal">0</span> –∑–≤.</div>

    <div id="menu" class="container active">
        <h1>GorAM App</h1>
        <button class="btn" onclick="openGame('clicker')">üëÜ –ö–õ–ò–ö–ï–† –ì–û–†–ê</button>
        <button class="btn" onclick="openGame('mines')">üí£ –ú–ò–ù–´ (500x)</button>
    </div>

    <div id="clicker" class="container">
        <button class="btn" onclick="goHome()">üîô –ù–∞–∑–∞–¥</button>
        <h1>–¢–∞–ø–∞–π –ì–æ—Ä–∞!</h1>
        <div class="gor-clicker" onclick="clickGor()"></div>
        <h2>–ù–∞—Ç—ã–∫–∞–Ω–æ: <span id="clicks">0</span></h2>
        <button class="btn" onclick="claimClicks()">üí∞ –ó–ê–ë–†–ê–¢–¨</button>
    </div>

    <div id="mines" class="container">
        <button class="btn" onclick="goHome()">üîô –ù–∞–∑–∞–¥</button>
        <h1>Mines 500x</h1>
        <input type="number" id="bet" value="100" style="width: 100%; padding: 10px; margin-bottom: 10px; font-size: 18px;">
        <h3 id="mult">x1.00</h3>
        <div class="grid" id="grid"></div>
        <button class="btn" id="startBtn" onclick="startMines()">–°–¢–ê–†–¢</button>
        <button class="btn" id="cashoutBtn" onclick="cashout()" style="display:none; background: #27ae60; color: white;">–ó–ê–ë–†–ê–¢–¨</button>
    </div>

    <audio id="sndPop" src="sounds/click.mp3"></audio>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ü–∞—Ä—Å–∏–º URL
        const params = new URLSearchParams(window.location.search);
        let uid = params.get('uid');
        let balance = parseInt(params.get('bal') || 0);
        document.getElementById('bal').innerText = balance;

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        function openGame(id) {
            document.querySelectorAll('.container').forEach(d => d.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        function goHome() { openGame('menu'); }

        // --- –ö–õ–ò–ö–ï–† ---
        let clicks = 0;
        function clickGor() {
            clicks++;
            document.getElementById('clicks').innerText = clicks;
            tg.HapticFeedback.impactOccurred('light');
            // –®–∞–Ω—Å –∑–≤—É–∫–∞ 25%
            if (Math.random() < 0.25) document.getElementById('sndPop').play().catch(()=>{});
        }
        function claimClicks() {
            if (clicks > 0) sendData('game_result', clicks, 'Clicker');
            clicks = 0; document.getElementById('clicks').innerText = 0;
        }

        // --- –ú–ò–ù–´ (500x Logic) ---
        let mineActive = false;
        let mineMap = [];
        let currentBet = 0;
        let currentMult = 1.0;
        let steps = 0;

        function startMines() {
            let bet = parseInt(document.getElementById('bet').value);
            if (balance < bet) return alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!");
            
            sendData('game_result', -bet, 'Mines Bet'); // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É —Å—Ä–∞–∑—É
            balance -= bet; 
            document.getElementById('bal').innerText = balance;

            currentBet = bet;
            mineActive = true;
            currentMult = 1.0;
            steps = 0;
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª—è (3 –±–æ–º–±—ã)
            mineMap = Array(25).fill(0);
            for(let i=0; i<3; i++) mineMap[i] = 1;
            mineMap.sort(() => Math.random() - 0.5);

            renderGrid();
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('cashoutBtn').style.display = 'block';
            document.getElementById('mult').innerText = "x1.00";
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for(let i=0; i<25; i++) {
                let d = document.createElement('div');
                d.className = 'cell';
                d.innerText = '‚ùì';
                d.onclick = () => checkTile(i, d);
                grid.appendChild(d);
            }
        }

        function checkTile(i, el) {
            if (!mineActive || el.classList.contains('safe')) return;

            if (mineMap[i] === 1) { // –ë–û–ú–ë–ê
                el.classList.add('bomb');
                el.innerText = 'üí£';
                endMines(false);
            } else { // –£–°–ü–ï–•
                el.classList.add('safe');
                el.innerText = 'üíé';
                steps++;
                // –§–æ—Ä–º—É–ª–∞ 500x: –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª 22 –∫–ª–µ—Ç–∫–∏ (–≤—Å–µ –∫—Ä–æ–º–µ –±–æ–º–±)
                if (steps === 22) currentMult = 500.0; 
                else currentMult *= 1.25; // –†–∞—Å—Ç–µ–º
                
                document.getElementById('mult').innerText = `x${currentMult.toFixed(2)}`;
            }
        }

        function cashout() {
            if (!mineActive) return;
            let win = Math.floor(currentBet * currentMult);
            sendData('game_result', win, 'Mines Win');
            balance += win;
            document.getElementById('bal').innerText = balance;
            endMines(true);
        }

        function endMines(won) {
            mineActive = false;
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('cashoutBtn').style.display = 'none';
            if (!won) alert("–í–ó–†–´–í!");
        }

        function sendData(action, profit, gameName) {
            tg.sendData(JSON.stringify({ action, profit, game: gameName }));
        }
    </script>
</body>
</html>